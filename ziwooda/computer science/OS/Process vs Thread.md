# Process vs Thread

## Process (프로세스)

> _프로그램을 메모리 상에서 실행 중인 작업을 의미하는 OS의 관리 단위_

⍢ 일반적으로 하나의 프로세스는 하나의 스레드를 가지고 작업을 수행한다.

⍢ OS는 프로세스에 가상메모리(virtual memory)를 제공하고, 해당 프로세스의 모든 스레드는 그 가상메모리로 수행 공간의 제약을 받는다.

⍢ 프로세스는 독립적인 주소공간을 할당한다.

- **Code** : 코드 자체를 구성하는 메모리 영역
- **Data** : 전역/정적변수, 배열 등
  - `segment .data`는 초기값이 필요한 전역변수를 선언
  - `segment .bss`는 초기값이 필요하지 않은 전역변수를 선언
- **Heap** : 동적 할당 시 사용 (ex. `new()`, `malloc()`)
- **Stack** : 지역변수, 매개변수, 반환값 (임시 메모리 영역)

<br>

## Thread (스레드)

> _프로세스 안에서 실행되는 하나 또는 여러 개의 작업 단위_

⍢ 프로세스와 유사하지만, 좀 더 구체적인 개념이다.

⍢ 스레드는 Stack만 할당 받고, 나머지 영역은 서로 공유한다.

<br>

**⍢ 프로세스와 스레드, 비유로 이해하기**

- process → 하나의 가구
- heap → 거실, 부엌 등의 공간
- thread → 그 내에 각자의 역할을 하는 세대원

‼️ **프로세스**는 **자신만의 고유 공간과 자원을 할당받아 사용**하지만, **스레드**는 **다른 스레드와 공간 및 자원을 공유**하면서 사용한다.
<br>

<img src="https://user-images.githubusercontent.com/70079416/222491496-d3826486-dd29-48ca-bd1f-0d957f0f3332.png" width="60%" height="60%" />

<br>

## Multi-Process vs Multi-Thread

**Multi-Process (멀티프로세스)** : 여러 개의 CPU로 여러 프로세스를 동시수행하는 것

**⍢ 장점**

- 메모리 침범 문제를 OS 차원에서 해결하므로 안전성이 보장된다.

**⍢ 단점**

- 각 프로세스가 독립된 메모리 영역을 지니므로 작업량이 많을수록 오버헤드가 발생할 수 있다.
- Context Switching(문맥교환)으로 인한 성능 저하

<br>

**Multi-Thread (멀티스레드)** : 하나의 프로세스 내에서 둘 이상의 스레드가 동시작업을 수행하는 것

**⍢ 장점**

- 사용자와의 응답성이 좋다.
  프로그램의 일부가 중단되거나 긴 작업이 수행되어도 프로그램의 수행은 계속되므로 사용자와의 응답성이 증가한다.
- 자원 공유
  스레드는 자동적으로 그들이 속한 프로세스의 자원들과 메모리를 공유한다.
- 경제성
  프로세스 생성에 메모리와 자원을 할당하면 비용이 많이 드는데 멀티스레드는 자신이 속한 프로세스의 자원을 공유하므로 시스템 자원의 낭비가 적다. 스레드를 생성하고 문맥교환을 하는 것이 더 경제적이다.

**⍢ 단점**

- 캐시나 TLB와 같은 하드웨어 리소스 공유 시 서로를 간섭할 수 있다.
- 하나의 스레드만 실행하면, 싱글 스레드의 실행 시간이 오히려 지연될 수 있다.
- 스레드 스케줄링 이슈
  스레드의 개수가 코어 수보다 많을 때, 스레드를 어떤 순서에 의해 동시성을 실행할 것인가에 대한 스케줄링 이슈가 존재한다.

<br>
‼️ **멀티프로세스**는 **각 프로세스가 독립적인 메모리를 가지고 별도로 실행**되지만, **멀티스레드**는 **각 스레드가 자신이 속한 프로세스의 메모리를 공유**한다.

<br>

**_⍢ Context Switching이란?_**

> 문맥교환 : 현재 CPU를 사용 중인 프로세스의 CPU 제어권이 다른 프로세스로 이양되는 과정
>
> 1. 실행 중인 프로세스의 CPU 시간할당량이 끝나거나 인터럽트 발생 시, 해당 프로세스 상태(문맥)를 PCB에 저장한다.
> 2. 다음에 실행할 프로세스의 문맥을 PCB에서 읽어 레지스터에 적재한다.
>
> 이와 같이 **인터럽트 발생 시에 PCB에 저장해두고, 재개될 때 PCB에서 문맥을 복원**한다.

---
